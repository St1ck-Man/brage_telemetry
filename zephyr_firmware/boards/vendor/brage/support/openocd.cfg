# OpenOCD configuration for Brage V1.0 board
# STM32U575CGT6 target

source [find interface/stlink.cfg]

transport select hla_swd

# Target configuration
source [find target/stm32u5x.cfg]

# Reset configuration
reset_config srst_only

# Speed configuration (in kHz)
adapter speed 2000

# Flash configuration
flash bank $_FLASHNAME stm32l4x 0x08000000 0 0 0 $_TARGETNAME

# Work area configuration
$_TARGETNAME configure -work-area-phys 0x20000000 -work-area-size 0x10000 -work-area-backup 0

# SWD frequency increase after init
$_TARGETNAME configure -event reset-init {
    adapter speed 4000
}

# Connect under reset for secure devices
$_TARGETNAME configure -event examine-start {
    # Enable debug during low power modes
    mmw 0xE0042004 0x00000007 0
    
    # Stop watchdog counters during halt
    mmw 0xE0042008 0x00001800 0
}